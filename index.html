<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸŽµ My Music Site</title>
  <style>
    body { background: #121212; color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
    h1 { color: #00ffd5; }
    ul { list-style: none; padding: 0; }
    li { margin: 10px 0; }
    button {
      padding: 10px 15px;
      background: #00ffd5;
      color: #000;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    input {
      padding: 8px;
      margin: 5px;
      border-radius: 4px;
      border: none;
      width: 250px;
    }
    audio { margin-top: 30px; width: 80%; }
  </style>
</head>
<body>
  <h1>ðŸŽ§ Background Music Player</h1>

  <div>
    <input type="text" id="songName" placeholder="Song Name">
    <input type="text" id="youtubeLink" placeholder="YouTube Link">
    <button onclick="addSong()">âž• Add</button>
  </div>

  <ul id="songList">Loading...</ul>
  <audio id="player" controls autoplay loop></audio>

  <script>
    const api = "https://a-gy5d.onrender.com"; // ðŸ” à¦à¦–à¦¾à¦¨à¦Ÿà¦¾ à¦¨à¦¿à¦œà§‡à¦° Render API URL à¦¦à¦¿à¦¨
    let songs = [];

    function extractID(link) {
      try {
        const url = new URL(link);
        return url.searchParams.get("v") || url.pathname.split("/").pop();
      } catch (e) {
        return link; // If it's already ID
      }
    }

    function loadSongs() {
      fetch(api + "/songs")
        .then(res => res.json())
        .then(data => {
          songs = data;
          renderSongs();
        });
    }

    function renderSongs() {
      const ul = document.getElementById("songList");
      ul.innerHTML = "";
      songs.forEach(song => {
        const li = document.createElement("li");
        li.innerHTML = `<button onclick="play('${song.id}')">â–¶</button> ${song.name}`;
        ul.appendChild(li);
      });
    }

    function play(id) {
      document.getElementById("player").src = api + "/stream/" + id;
    }

    function addSong() {
      const name = document.getElementById("songName").value.trim();
      const link = document.getElementById("youtubeLink").value.trim();
      if (!name || !link) return alert("à¦¦à§Ÿà¦¾ à¦•à¦°à§‡ à¦¨à¦¾à¦® à¦“ YouTube à¦²à¦¿à¦‚à¦• à¦¦à¦¿à¦¨");

      const id = extractID(link);
      songs.push({ name, id });
      renderSongs();
      document.getElementById("songName").value = "";
      document.getElementById("youtubeLink").value = "";
    }

    loadSongs();
  </script>
</body>
</html>
